<?xml version='1.0' encoding='UTF-8'?>
<project>
  <actions/>
  <description>This is a template build to produce an Android project with code coverage enabled and Lint reporting. To best use the template, you must add the following configurations:&#xd;
&lt;br&gt;1) You must specify the PARENT_PROJECT parameter with the correct name of the job as it is provided in the upstream job.&#xd;
&lt;br&gt;2) You must specify the PROJECT_APK parameter which is the *-instrumented.apk product from the upstream job.&#xd;
&lt;br&gt;3) You must specify the TEST_APK parameter which is the *Test-debug.apk product from the upstream job.&#xd;
&lt;br&gt;4) You must specify the NODE_HOST_TEST_DIR which is the shared directory on the system to which your test devices are connected and in which the test runner script is deployed.&#xd;
&lt;br&gt;5) COVERAGE_ENABLED has a suitable default specified. Setting this to false would undermine the purpose of the upstream build being configured as it is. This parameter is required by the test runner script.&#xd;
&lt;br&gt;6) JUNIT_TEST_SUITE has a suitable default specified. Customize this to fit any desired suite your project contains. This parameter is required by the test runner script.&#xd;
&lt;br&gt;7) JUNIT_TEST_RUNNER has a third-party test runner defined which provides XML output. If you have not included that in your test project, the field&apos;s description contains the SDK-provided default for your reference. This parameter is required by the test runner script.&#xd;
&lt;br&gt;&#xd;
&lt;br&gt;These parameters are a convenience to generalize the config for commandline use according to the &lt;a href=&quot;http://developer.android.com/tools/building/building-cmdline.html&quot;&gt;Android developer documentation&lt;/a&gt;&#xd;
&lt;br&gt;&#xd;
&lt;br&gt;NOTE: this config &lt;b&gt;only applies to an environment running Mac OSX Mountain Lion&lt;/b&gt;. There may be subtle differences between sed and REGEX in your shell environment.</description>
  <logRotator class="hudson.tasks.LogRotator">
    <daysToKeep>-1</daysToKeep>
    <numToKeep>20</numToKeep>
    <artifactDaysToKeep>-1</artifactDaysToKeep>
    <artifactNumToKeep>-1</artifactNumToKeep>
  </logRotator>
  <keepDependencies>false</keepDependencies>
  <properties>
    <hudson.model.ParametersDefinitionProperty>
      <parameterDefinitions>
        <hudson.model.StringParameterDefinition>
          <name>PARENT_PROJECT</name>
          <description>The Jenkins project name of the parent project. This string is used to determine the path of the parent&apos;s directory.</description>
          <defaultValue>AndroidCoverageBuildTemplate</defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>PROJECT_APK</name>
          <description>The full path within the workspace to the *-instrumented.apk file generated by the upstream job. </description>
          <defaultValue></defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>TEST_APK</name>
          <description>The full path within the workspace to the *Test-debug.apk file generated by the upstream job. </description>
          <defaultValue></defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>NODE_HOST_TEST_DIR</name>
          <description>This is the full filesystem path to the directory on the slave node host computer which contains the test runner script and will be used to contain directories for artifacts and output from successive test runs.</description>
          <defaultValue></defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>COVERAGE_ENABLED</name>
          <description>This tells the test runner script to enable capturing of code coverage output. This is set to true because the upstream job is specifically configured to enable coverage on live devices.</description>
          <defaultValue>true</defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>JUNIT_TEST_SUITE</name>
          <description>&quot;NOSUITEPROVIDED&quot; is coded into the test runner script that is in the NODE_HOST_TEST_DIR on the system to which the test devices are connected. This is the default value it expects in order to run all tests. If your project wants or needs to use a test suite, replace this variable with the suite that you want this job to execute instead.</description>
          <defaultValue>NOSUITEPROVIDED</defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>JUNIT_TEST_RUNNER</name>
          <description>This test runner is not provided in the Android SDK but it (or one like it) is required if you want XML output from your tests. Please visit https://code.google.com/p/the-missing-android-xml-junit-test-runner/ for more information.

If you do not desire XML output, or if you want to just use the standard default test runner, change this parameter to the SDK-provided Instrumentation test runner: &quot;android.test.InstrumentationTestRunner&quot;. Please visit http://developer.android.com/reference/android/test/InstrumentationTestRunner.html for more information.</description>
          <defaultValue>pl.polidea.instrumentation.PolideaInstrumentationTestRunner</defaultValue>
        </hudson.model.StringParameterDefinition>
      </parameterDefinitions>
    </hudson.model.ParametersDefinitionProperty>
  </properties>
  <scm class="hudson.scm.NullSCM"/>
  <assignedNode>###REPLACE THIS WITH THE NAME OF YOUR DEVICE SLAVE NODE. SURROUND WITH QUOTES FOR NAMES WITH SPACES###</assignedNode>
  <canRoam>false</canRoam>
  <disabled>false</disabled>
  <blockBuildWhenDownstreamBuilding>false</blockBuildWhenDownstreamBuilding>
  <blockBuildWhenUpstreamBuilding>false</blockBuildWhenUpstreamBuilding>
  <triggers/>
  <concurrentBuild>false</concurrentBuild>
  <builders>
    <hudson.plugins.copyartifact.CopyArtifact plugin="copyartifact@1.26">
      <project>$PARENT_PROJECT</project>
      <filter>**/*-debug.apk, **/.build_extras/*, **/*-instrumented.apk, **/*.em</filter>
      <target>.</target>
      <selector class="hudson.plugins.copyartifact.TriggeredBuildSelector"/>
      <flatten>true</flatten>
    </hudson.plugins.copyartifact.CopyArtifact>
    <hudson.tasks.Shell>
      <command># copy binaries to local archive folder inside the $NODE_HOST_TEST_DIR

TEST_ID=`cat test_id.txt`
mkdir -p $NODE_HOST_TEST_DIR/$TEST_ID
cp $PROJECT_APK $NODE_HOST_TEST_DIR/$TEST_ID/$PROJECT_APK
cp $TEST_APK $NODE_HOST_TEST_DIR/$TEST_ID/$TEST_APK
cp coverage.em $NODE_HOST_TEST_DIR/$TEST_ID/coverage.em</command>
    </hudson.tasks.Shell>
    <hudson.tasks.Shell>
      <command># run tests on device using the test runner which captures all output

TEST_ID=`cat test_id.txt`
cd $NODE_HOST_TEST_DIR
./test_runner_script.sh $TEST_ID $PROJECT_APK $TEST_APK $DEVICE_SERIAL $JUNIT_TEST_SUITE $JUNIT_TEST_RUNNER $COVERAGE_ENABLED</command>
    </hudson.tasks.Shell>
    <hudson.tasks.Shell>
      <command># copy results back

TEST_ID=`cat test_id.txt`
cp -r $NODE_HOST_TEST_DIR/$TEST_ID/results/$DEVICE_SERIAL .</command>
    </hudson.tasks.Shell>
  </builders>
  <publishers>
    <hudson.tasks.ArtifactArchiver>
      <artifacts>**/logcat.txt, **/*-TEST.xml,**/*.jpg, **/*coverage.ec, coverage/, **/*coverage.xml, **/*.apk</artifacts>
      <latestOnly>false</latestOnly>
      <allowEmptyArchive>false</allowEmptyArchive>
    </hudson.tasks.ArtifactArchiver>
    <hudson.tasks.junit.JUnitResultArchiver>
      <testResults>**/*-TEST.xml</testResults>
      <keepLongStdio>false</keepLongStdio>
      <testDataPublishers/>
    </hudson.tasks.junit.JUnitResultArchiver>
    <hudson.plugins.emma.EmmaPublisher plugin="emma@1.29">
      <includes>./0149BD7D06014019/coverage.xml</includes>
      <healthReports>
        <minClass>0</minClass>
        <maxClass>100</maxClass>
        <minMethod>0</minMethod>
        <maxMethod>70</maxMethod>
        <minBlock>0</minBlock>
        <maxBlock>80</maxBlock>
        <minLine>0</minLine>
        <maxLine>80</maxLine>
        <minCondition>0</minCondition>
        <maxCondition>80</maxCondition>
      </healthReports>
    </hudson.plugins.emma.EmmaPublisher>
  </publishers>
  <buildWrappers/>
</project>